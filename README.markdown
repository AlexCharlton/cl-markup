# CL-MARKUP - Modern markup generation library for Common Lisp

## About

* Fast (even faster if you compile it)
* Support multiple document types (markup, xml, html, xhtml)
* Output with doctype
* Direct output to stream
* Escape embedded strings automatically

## Usage

    (html
     (:body
      (:p :id "title" "aiueo")))
    ;=> "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"
    ;    \"http://www.w3.org/TR/html4/loose.dtd\">
    ;    <html><body><p id=\"title\">aiueo</p></body></html>"

## Installation

## Really fast this?

Macros, provided by CL-MARKUP, generates really efficient code. They convert into just a calling `write-string' as possible. See following two examples and how CL-MARKUP expands them.

Example A:

    ;; Example A
    (let ((*output-stream* t))
       (loop for (link . title) in '(("http://zappa.com/" . "Frank Zappa")
                                     ("http://marcusmiller.com/" . "Marcus Miller")
                                     ("http://www.milesdavis.com/" . "Miles Davis"))
             do (markup (:a :href link
                            (:b title))
                        (:br))))

    ;; Example A: generated by CL-MARKUP
    (let ((*output-stream* t))
      (loop for (link . title) in '(("http://zappa.com/" . "Frank Zappa")
                                    ("http://marcusmiller.com/" . "Marcus Miller")
                                    ("http://www.milesdavis.com/" . "Miles Davis"))
            do (if *output-stream*
                   (progn (write-string "<a href=\"" *output-stream*)
                          (write-string (escape-string (cl-markup::ensure-string link))
                                        *output-stream*)
                          (write-string "\"><b>" *output-stream*)
                          (write-string (escape-string (cl-markup::ensure-string title))
                                        *output-stream*)
                          (write-string "</b></a><br />" *output-stream*))
                   (with-output-to-string (#:g0)
                     (write-string "<a href=\"" #:g0)
                     (write-string (escape-string (cl-markup::ensure-string link)) #:g0)
                     (write-string "\"><b>" #:g0)
                     (write-string (escape-string (cl-markup::ensure-string title)) #:g0)
                     (write-string "</b></a><br />" #:g0)))))

Example B:

    ;; Example B
    (markup
     (:table :border 0 :cellpadding 4
             (loop for i below 25 by 5
                   collect
                   (markup
                     (:tr :align "right"
                          (loop for j from i below (+ i 5)
                                collect
                                (markup
                                  (:td :bgcolor
                                       (if (oddp j)
                                           "pink"
                                           "green")
                                       (format nil "~@R" (1+ j))))))))))

    ;; Example B: generated by CL-MARKUP
    (if *output-stream*
        (progn (write-string "<table border=\"0\" cellpadding=\"4\">"
                             *output-stream*)
               (write-string (let ((#:g6
                                    (loop for i below 25 by 5
                                          collect (markup
                                                   (:tr
                                                    :align
                                                    "right"
                                                    (loop for j
                                                          from
                                                          i
                                                          below
                                                          (+ i 5)
                                                     collect (markup
                                                              (:td
                                                               :bgcolor
                                                               (if
                                                                (oddp j)
                                                                "pink"
                                                                "green")
                                                               (format
                                                                nil
                                                                "~@R"
                                                                (1+ j))))))))))
                                    (if (listp #:g6)
                                        (format nil "~{~A~}" #:g6)
                                        #:g6))
                                   *output-stream*)
                               (write-string "</table>" *output-stream*))
                             (with-output-to-string (#:g0)
                               (write-string "<table border=\"0\" cellpadding=\"4\">"
                                             #:g0)
                               (write-string (let
                                              ((#:g6
                                                (loop for i below 25 by 5
                                                 collect (markup
                                                          (:tr
                                                           :align
                                                           "right"
                                                           (loop for j
                                                                 from
                                                                 i
                                                                 below
                                                                 (+ i 5)
                                                            collect (markup
                                                                     (:td
                                                                      :bgcolor
                                                                      (if
                                                                       (oddp j)
                                                                       "pink"
                                                                       "green")
                                                                      (format
                                                                       nil
                                                                       "~@R"
                                                                       (1+
                                                                        j))))))))))
                                                (if
                                                 (listp #:g6)
                                                 (format nil "~{~A~}" #:g6)
                                                 #:g6))
                                               #:g0)
                                              (write-string "</table>" #:g0)))

## Markup language

<code>markup</code> is the most simple way to generate HTML.

    (markup (:p "あいうえお"))
    ;=> "<p>あいうえお</p>"

Other macros <code>html</code>, <code>xhtml</code> and <code>xml</code>, outputs DOCTYPE before <code>markup</code>.

    (html (:p "あいうえお") (:br))
    ;=> "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"><html><p>あいうえお</p><br></html>"

    (xhtml (:p "あいうえお") (:br))
    ;=> "<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><html><p>あいうえお</p><br /></html>"

    (xml (:p "あいうえお") (:br))
    ;=> "<?xml version=\"1.0\" encoding=\"UTF-8\"?><p>あいうえお</p><br />"

## Escape

Embedded strings will be escaped automatically.

    (markup (:p "Tiffany & Co."))
    ;=> "<p>Tiffany &amp; Co.</p>"

If you don't hope this behavior, set <code>\*auto-escape\*</code> nil or use <code>raw</code> in order to suppress it temporally.

    (let ((*auto-escape* nil))
      (markup (:p "Tiffany & Co.")))
    ;=> "<p>Tiffany & Co.</p>"

    (markup (:p (raw "Tiffany & Co.")))
    ;=> "<p>Tiffany & Co.</p>"

In a contrasting case, <code>esc</code> is available about it.

## Direct output to stream

Markup macros returns html as a string. You can customize this behavior using <code>\*output-stream\*</code>.

    ;; Default behavior
    (let (*output-stream*)
      (markup (:p "hoge"))
    ;=> "<p>hoge</p>"

    ;; Output to *standard-output* directly
    (let ((*output-stream* t))
      (markup (:p "hoge")))
    ;;=> <p>hoge</p>
    ;=> "<p>hoge</p>"

## Markup syntax

You can embeded Lisp code in a tag body.

    (markup (:ul (loop for item in '(1 2 3) collect (markup (:li item)))))

But, <code>markup</code> is too long to embed. CL-MARKUP provides an usefull syntax to write more shortly. To enable it, put <code>(enable-markup-syntax)</code> before.

    (enable-markup-syntax)
    #M(:ul (loop for item in '(1 2 3) collect #M(:li item))))

## License

Copyright (c) 2011 Eitarow Fukamachi.  
Licensed under the LLGPL License.
